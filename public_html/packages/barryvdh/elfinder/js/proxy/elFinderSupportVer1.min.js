"use strict";window.elFinderSupportVer1=function(b){var a=this;this.upload=b||"auto";this.init=function(c){this.fm=c;this.fm.parseUploadData=function(g){var d;if(!$.trim(g)){return{error:["errResponse","errDataEmpty"]}}try{d=$.parseJSON(g)}catch(f){return{error:["errResponse","errDataNotJSON"]}}return a.normalize("upload",d)}};this.send=function(c){var k=this,h=this.fm,d=$.Deferred(),e=c.data.cmd,g=[],i={},f,j;d.abort=function(){j.state()=="pending"&&j.abort()};switch(e){case"open":c.data.tree=1;break;case"parents":case"tree":return d.resolve({tree:[]});break;case"get":c.data.cmd="read";c.data.current=h.file(c.data.target).phash;break;case"put":c.data.cmd="edit";c.data.current=h.file(c.data.target).phash;break;case"archive":case"rm":c.data.current=h.file(c.data.targets[0]).phash;break;case"extract":case"rename":case"resize":c.data.current=h.file(c.data.target).phash;break;case"duplicate":i=$.extend(true,{},c);$.each(c.data.targets,function(l,m){$.ajax($.extend(i,{data:{cmd:"duplicate",target:m,current:h.file(m).phash}})).error(function(n){h.error(h.res("error","connect"))}).done(function(n){n=k.normalize("duplicate",n);if(n.error){h.error(n.error)}else{if(n.added){h.trigger("add",{added:n.added})}}})});return d.resolve({});break;case"mkdir":case"mkfile":c.data.current=c.data.target;break;case"paste":c.data.current=c.data.dst;break;case"size":return d.resolve({error:h.res("error","cmdsupport")});break;case"search":return d.resolve({error:h.res("error","cmdsupport")});break}j=$.ajax(c).fail(function(l){d.reject(l)}).done(function(l){f=k.normalize(e,l);if(e=="paste"&&!f.error){h.sync();d.resolve({})}else{d.resolve(f)}});return d;return $.ajax(c)};this.normalize=function(g,f){var c=this,e={},d=function(i){return i&&i.hash&&i.name&&i.mime?i:null},h;if((g=="tmb"||g=="get")){return f}if(g=="upload"&&f.error&&f.cwd){f.warning=$.extend({},f.error);f.error=false}if(f.error){return f}if(g=="put"){h=this.fm.file(f.target.hash).phash;return{changed:[this.normalizeFile(f.target,h)]}}h=f.cwd.hash;if(f.tree){$.each(this.normalizeTree(f.tree),function(k,j){e[j.hash]=j})}$.each(f.cdc||[],function(k,j){var l=j.hash;if(e[l]){e[l].date=j.date;e[l].locked=j.hash==h?true:j.rm===void (0)?false:!j.rm}else{e[l]=c.normalizeFile(j,h,f.tmb)}});if(!f.tree){$.each(this.fm.files(),function(j,i){if(!e[j]&&i.phash!=h&&i.mime=="directory"){e[j]=i}})}if(g=="open"){return{cwd:e[h]||this.normalizeFile(f.cwd),files:$.map(e,function(i){return i}),options:c.normalizeOptions(f),init:!!f.params,debug:f.debug}}return $.extend({current:f.cwd.hash,error:f.error,warning:f.warning,options:{tmb:!!f.tmb}},this.fm.diff($.map(e,d)))};this.normalizeTree=function(d){var e=this,c=[],f=function(j,k){var h,g;for(h=0;h<j.length;h++){g=j[h];c.push(e.normalizeFile(g,k));g.dirs.length&&f(g.dirs,g.hash)}};f([d]);return c};this.normalizeFile=function(d,h,f){var e=d.mime||"directory",c=e=="directory"&&!d.linkTo?0:d.size,g={url:d.url,hash:d.hash,phash:h,name:d.name,mime:e,date:d.date||"unknown",size:c,read:d.read,write:d.write,locked:!h?true:d.rm===void (0)?false:!d.rm};if(d.mime=="application/x-empty"){g.mime="text/plain"}if(d.linkTo){g.alias=d.linkTo}if(d.linkTo){g.linkTo=d.linkTo}if(d.tmb){g.tmb=d.tmb}else{if(g.mime.indexOf("image/")===0&&f){g.tmb=1}}if(d.dirs&&d.dirs.length){g.dirs=true}if(d.dim){g.dim=d.dim}if(d.resize){g.resize=d.resize}return g};this.normalizeOptions=function(d){var c={path:d.cwd.rel,disabled:d.disabled||[],tmb:!!d.tmb,copyOverwrite:true};if(d.params){c.api=1;c.url=d.params.url;c.archivers={create:d.params.archives||[],extract:d.params.extract||[]}}if(c.path.indexOf("/")!==-1){c.separator="/"}else{if(c.path.indexOf("\\")!==-1){c.separator="\\"}}return c}};