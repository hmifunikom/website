"use strict";window.elFinderSupportVer1=function(c){var d=this;this.upload=c||"auto";this.init=function(a){this.fm=a;this.fm.parseUploadData=function(b){var h;if(!$.trim(b)){return{error:["errResponse","errDataEmpty"]}}try{h=$.parseJSON(b)}catch(e){return{error:["errResponse","errDataNotJSON"]}}return d.normalize("upload",h)}};this.send=function(r){var a=this,m=this.fm,q=$.Deferred(),p=r.data.cmd,n=[],l={},o,b;q.abort=function(){b.state()=="pending"&&b.abort()};switch(p){case"open":r.data.tree=1;break;case"parents":case"tree":return q.resolve({tree:[]});break;case"get":r.data.cmd="read";r.data.current=m.file(r.data.target).phash;break;case"put":r.data.cmd="edit";r.data.current=m.file(r.data.target).phash;break;case"archive":case"rm":r.data.current=m.file(r.data.targets[0]).phash;break;case"extract":case"rename":case"resize":r.data.current=m.file(r.data.target).phash;break;case"duplicate":l=$.extend(true,{},r);$.each(r.data.targets,function(f,e){$.ajax($.extend(l,{data:{cmd:"duplicate",target:e,current:m.file(e).phash}})).error(function(g){m.error(m.res("error","connect"))}).done(function(g){g=a.normalize("duplicate",g);if(g.error){m.error(g.error)}else{if(g.added){m.trigger("add",{added:g.added})}}})});return q.resolve({});break;case"mkdir":case"mkfile":r.data.current=r.data.target;break;case"paste":r.data.current=r.data.dst;break;case"size":return q.resolve({error:m.res("error","cmdsupport")});break;case"search":return q.resolve({error:m.res("error","cmdsupport")});break}b=$.ajax(r).fail(function(e){q.reject(e)}).done(function(e){o=a.normalize(p,e);if(p=="paste"&&!o.error){m.sync();q.resolve({})}else{q.resolve(o)}});return q;return $.ajax(r)};this.normalize=function(b,i){var l=this,j={},k=function(e){return e&&e.hash&&e.name&&e.mime?e:null},a;if((b=="tmb"||b=="get")){return i}if(b=="upload"&&i.error&&i.cwd){i.warning=$.extend({},i.error);i.error=false}if(i.error){return i}if(b=="put"){a=this.fm.file(i.target.hash).phash;return{changed:[this.normalizeFile(i.target,a)]}}a=i.cwd.hash;if(i.tree){$.each(this.normalizeTree(i.tree),function(e,f){j[f.hash]=f})}$.each(i.cdc||[],function(f,g){var e=g.hash;if(j[e]){j[e].date=g.date;j[e].locked=g.hash==a?true:g.rm===void (0)?false:!g.rm}else{j[e]=l.normalizeFile(g,a,i.tmb)}});if(!i.tree){$.each(this.fm.files(),function(e,f){if(!j[e]&&f.phash!=a&&f.mime=="directory"){j[e]=f}})}if(b=="open"){return{cwd:j[a]||this.normalizeFile(i.cwd),files:$.map(j,function(e){return e}),options:l.normalizeOptions(i),init:!!i.params,debug:i.debug}}return $.extend({current:i.cwd.hash,error:i.error,warning:i.warning,options:{tmb:!!i.tmb}},this.fm.diff($.map(j,k)))};this.normalizeTree=function(g){var b=this,h=[],a=function(f,e){var i,l;for(i=0;i<f.length;i++){l=f[i];h.push(b.normalizeFile(l,e));l.dirs.length&&a(l.dirs,l.hash)}};a([g]);return h};this.normalizeFile=function(k,a,i){var j=k.mime||"directory",l=j=="directory"&&!k.linkTo?0:k.size,b={url:k.url,hash:k.hash,phash:a,name:k.name,mime:j,date:k.date||"unknown",size:l,read:k.read,write:k.write,locked:!a?true:k.rm===void (0)?false:!k.rm};if(k.mime=="application/x-empty"){b.mime="text/plain"}if(k.linkTo){b.alias=k.linkTo}if(k.linkTo){b.linkTo=k.linkTo}if(k.tmb){b.tmb=k.tmb}else{if(b.mime.indexOf("image/")===0&&i){b.tmb=1}}if(k.dirs&&k.dirs.length){b.dirs=true}if(k.dim){b.dim=k.dim}if(k.resize){b.resize=k.resize}return b};this.normalizeOptions=function(a){var b={path:a.cwd.rel,disabled:a.disabled||[],tmb:!!a.tmb,copyOverwrite:true};if(a.params){b.api=1;b.url=a.params.url;b.archivers={create:a.params.archives||[],extract:a.params.extract||[]}}if(b.path.indexOf("/")!==-1){b.separator="/"}else{if(b.path.indexOf("\\")!==-1){b.separator="\\"}}return b}};